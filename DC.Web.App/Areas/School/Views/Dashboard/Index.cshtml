@model  DC.Web.App.Models.ViewModel<IEnumerable<DC.Web.App.Models.KeyValue>, string, string>
@{
    ViewBag.Title = "Manage " + Model.Title + "";
    var rolelist = (from item in Model.tData
                    select new SelectListItem
                    {
                        Text = item.Title,
                        Value = item.Id,
                    }).ToList();
}
<style>
    .table td {
        padding: 7px;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
    }

    .table tr:hover {
        background: #f5efce;
    }

    element.style {
    }



    h1, .h1, h2, .h2, h3, .h3 {
        margin-top: 0px;
        margin-bottom: 5px;
    }

    .inputfile {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
    }

        .inputfile + label {
            display: inline-block;
            padding: 3px 6px;
            border: 1px solid #9ACE48;
            background: #9ACE48;
            color: #fff;
            cursor: pointer;
        }
</style>
@if (Model.Status == 200)
{
<div class="container">
    <div class="row">
      <div class="col-lg-12">
         <ol class="breadcrumb" id="olBredcrumb">
        <li class="breadcrumb-item hidden" id="btnBack">
            <a href="javascript:void(0);" onclick="CancelAdd();"><i class=" fa fa-arrow-circle-left"></i>&nbsp;Back </a>
        </li>
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index","Admin",new {area="CP" })">Home</a>
        </li>
        <li class="breadcrumb-item active "> <a href="@Url.Action("School", "Manage", new { area = "" })">@Model.Title</a></li>
    </ol>
      </div>
    </div>
   

    @Html.Hidden("maxRows", "500")
    @Html.Hidden("page", "1")
    @Html.Hidden("currentRow", "0")

    <div class="row">
        <div class="col-lg-12">
          <div id="pageAdd" class="form-data"></div>
        </div>
    </div>

   <div class="row">
    <div id="pageData" class="text-center">
        <div class="col-lg-2 col-xs-12">
            @Html.DropDownListFor(m => m.DatatId, rolelist, new { onchange = " FillData()", @class = "form-control" })
        </div>
        <div class="col-lg-8 col-xs-8">
            <div class="form-group has-feedback ">
                <input onkeyup="Search()" type="text" class="form-control" id="txtSearch" name="txtSearch" placeholder="Search By Name">
                <span class="fa fa-search form-control-feedback"></span>
            </div>
        </div>
        <div class="col-lg-2 col-xs-4 text-right">

            <button type="button" title="Click refresh data." class="btn btn-sm  btn-primary" onclick="return FillData();"><i class="fa fa-refresh"></i></button>
            <button data-role="@Model.Title" data-roleid=" @Model.DatatId" type="button" id="btnAdd" onclick="return Add('Create New School','');" title="Click for add ." class="btn btn-sm btn-primary"><i class="fa fa-plus"></i></button>


        </div>
        <div class="col-lg-12">
            <table id="tblData" class="table table-bordered ">
                <tr>
                    <td class="text-center">
                        Working on it   <img src="~/Images/inlineloader.gif" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
  </div>


</div>

    @section Scripts {


        <script src="~/Scripts/jquery.toaster.js"></script>
        <script src="~/Scripts/bootbox.min.js"></script>
        <script src="~/Scripts/Common.js"></script>

        <script>
            function copyToClipboard(text) {
                var sampleTextarea = document.createElement("textarea");
                document.body.appendChild(sampleTextarea);
                sampleTextarea.value = text; //save main text in it
                sampleTextarea.select(); //select textarea contenrs
                document.execCommand("copy");
                document.body.removeChild(sampleTextarea);

                //navigator.clipboard.writeText(text);

                $("#toaster").html("");
                $.toaster({ priority: 'success', title: "Copy credential", message: "Data has been copied at clipboard." });
                return false;
            }
            function CopyData(obj) {
               
                var uname = $(obj).attr("data-user")
                var pwd = $(obj).attr("data-pwd")
                var copyText = "User name: " + uname + " , Password: " + pwd + "";
                copyToClipboard(copyText);
                return false;
            }
            function CancelAdd(obj) {
              
                
                $("#pageData").css({ "display": "" })
                $("#pageAdd").css({ "display": "none" })
                $("#btnBack").addClass("hidden");
            }
            function Search() {
                var input, filter, table, tr, td, i;
                input = document.getElementById("txtSearch");
                filter = input.value.toUpperCase();
                table = document.getElementById("tblData");
                tr = table.getElementsByTagName("tr");

                for (i = 0; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[0];
                    if (td) {
                        if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                            tr[i].style.display = "none";
                        }
                    }

                }
            }
            function Add(title,id) {
                var btnhtml = $("#btnAdd").html();
                $("#btnAdd").html("Wait.. <i class='fa fa-spinner fa-spin'></i>");
                $("#btnAdd").attr("disabled", "disabled");
                //var Role =  $("#btnAdd").attr("data-role");
                //var RoleId = $("#btnAdd").attr("data-roleid");

                var Role = $("#DatatId option:selected").text();
                var RoleId = $("#DatatId option:selected").val();

                 AddLoader();
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("AddSchhol", "Dashboard", new {area="School" })',
                    data: { Id: id, Title: title, Role: Role, RoleId: RoleId},
                    success: function (data) {
                        $("#btnAdd").html(btnhtml);
                        $("#btnAdd").removeAttr("disabled");
                        $("#pageAdd").css({ "display": "" });
                        $("#pageData").css({ "display": "none" });
                        $("#pageAdd").html(data);
                        title = title == "" ? "Create New " : title;
                        $("#h3Title").html(title);

                    },
                    complete: function (data) {
                        $("#btnAdd").html(btnhtml);
                        $("#btnAdd").removeAttr("disabled");
                        RemoveLoader();
                    },
                    error: function (data) {

                        $("#btnAdd").html(btnhtml);
                        $("#btnAdd").removeAttr("disabled");
                        RemoveLoader();
                    }
                });
            }
            function View(popupTitle, id, uc) {
                AddLoader();
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("ViewSchool", "Dashboard", new {area= "School" })',
                    data: { Id: id, ucName: uc },
                    success: function (data) {

                        bootbox.dialog({
                            size: "large",
                            title: "<i class='fa fa-building-o'>  </i>      : " + popupTitle+"",
                            message: data,
                            closeButton: true,
                            buttons: {
                                success: {
                                    label: "Close",
                                    className: "jsLoading    btn btn-default",
                                    callback: function () {
                                        bootbox.hideAll();
                                    }
                                }
                            }
                        });
                        RemoveLoader();
                    },
                    complete: function (data) {
                        RemoveLoader();
                    },
                    error: function (data) {
                        RemoveLoader();
                    }
                });
            }
            function FillData() {

                CancelAdd();
                AddLoader();

                $("#tblData").html('<tr><td class="text-center">Working on it <img src="/Images/inlineloader.gif" /> </td> </tr>');
                var RoleId = "";
                $.each($("#DatatId option"), function () {
                    RoleId += "'"+$(this).val() +"',"
                })
                RoleId = RoleId+"'1'"
                var maxRows = $.trim($("#maxRows").val());
                var page = $.trim($("#page").val());
                var currentRow = $.trim($("#currentRow").val());
                if (RoleId == "") {
                    $("#tblData").html('<tr><td class="tetx-left h3">Data not found.</td></tr>');
                    RemoveLoader();
                    return;
                }
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("Gets", "Dashboard", new {area="School"})',
                    data: {RoleId: RoleId, maxRows: maxRows, page: page, currentRow: currentRow},
                    dataType: "json",
                    success: function (data) {
                        var rowdata = '';
                        if (data.StatusCode == 200) {
                            var currentstatus = "";
                            var thead = "<thead><tr>  <th class='text-left' >School Detail</th>"
                                + " <th class='text-center' width='10%'  title='Action'><i class='fa fa-cogs'></i></th> </tr>   <tr></thead>  ";
                            var role = $("#DatatId option:selected").text();
                            var roleid = $("#DatatId option:selected").val();
                            var tdclass="td-inactive"
                            $.each(data.results, function () {
                                if (this.Status == '@DC.Status.Active.GetHashCode()') {
                                    tdclass = ""
                                    currentstatus = '&nbsp;<button data-id="' + this.Id + '"  data-title="' + this.Name + '" title="Currennt status is Active click to In-Active." type="button" class="jsLoading jsActiveInactive btn btn-primary btn-xs"><i class="fa fa-check-square"></i></button>';
                                }
                                else {
                                    tdclass = "td-inactive"
                                    currentstatus = '&nbsp;<button data-id="' + this.Id + '"  data-title="' + this.Name + '" title="Currennt status is In-Active click to Active." type="button" class="jsLoading jsActiveInactive btn btn-primary btn-xs"><i class="fa fa-close"></i></button>'
                                }
                                var detail = '<span class="text-muted small">Name: ' + this.Name + ' | Mob No: ' + this.ContactNo + ' | Email: ' + this.Email + ' | State: ' + this.State + '  '
                                    + '| City: ' + this.City + ' '
                                    + '| Pincode: ' + this.PinCode + ' '
                                    + '| Strength: ' + this.Strength + ' '
                                    + '| ITIncharge: ' + this.ITIncharge + ' '
                                    + '| Board: ' + this.MasterBoard + ' '

                                    + '</span> '  
                                rowdata += '<tr id="tr_' + this.Id + ' " class="' + tdclass +'">'
                                    + '<td class="text-left "> <a data-uc="' + this.ucName + '"  data-title="' + this.Name + '(' + this.SchoolCode+')" data-id="' + this.Id + '" title="Click for view data."  class="jsLoading jsView h4 text-primary" href="javascript:void(0);">  <h3>' + this.Name +' | '+this.SchoolCode+'</h3>'+ detail+  '   </a>'
                                    + '&nbsp;<span data-pwd="' + this.Password + '"  data-user="' + this.UserName + '" onclick="return CopyData(this)" title="click for copy credentials." class="fa fa-lock btn "> </span>'
                                    + '</td>'
                                    + ' <td class="text-center"><button  data-role="' + role + '" data-roleid="' + roleid + '"  type="button" data-title="' + this.Name + '" data-id="' + this.Id + '" title="Click for edit data."  class="jsLoading jsEdit btn btn-primary btn-xs"><i class="fa fa-pencil"></i></button>'
                                    + currentstatus
                                    + '</td></tr>';
                            });
                            if (data.results.length > 0) {
                                $("#tblData").html(thead + rowdata);
                                RemoveLoader();
                                Search();
                            }
                            else {

                                $("#tblData").html('<tr><td class="tetx-left h3 text-danger">' + data.Message+'</td></tr>');
                               // $.toaster({ priority: 'danger', title: "Error", message: data.Message });
                                RemoveLoader();
                            }

                        }

                        else if (data.StatusCode == 201) {
                            //$.toaster({ priority: 'info', title: "Info", message: data.Message });
                            $("#tblData").html('<tr><td class="tetx-left h3 text-info">' + data.Message + '</td></tr>');
                            RemoveLoader();
                        }
                        else {
                           // $.toaster({ priority: 'danger', title: "Error", message: "Some error occur try later." });
                            $("#tblData").html('<tr><td class="tetx-left h3 text-danger">Some error occur try later.</td></tr>');
                            RemoveLoader();
                        }
                    },
                    complete: function (data) {
                        RemoveLoader();
                    },
                    error: function (data) {
                       // $.toaster({ priority: 'danger', title: "Error", message: "Some error occur try later." });
                        $("#tblData").html('<tr><td class="tetx-left h3 text-danger">Some error occur try later.</td></tr>');
                        RemoveLoader();
                    },
                });
            }
            function ActiveInactive(Id) {
                $("#toaster").html("");
                $.toaster({ priority: 'success', title: "Active/Inactive", message: data.Message });
                AddLoader();
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ActiveInactive", "Dashboard", new {area= "School" })',
                    data: { Id: Id},
                    dataType: "json",
                    success: function (data) {
                        if (data.StatusCode == 200) {
                            FillData();
                            $.toaster({ priority: 'success', title: "Active/Inactive", message: data.Message });
                            RemoveLoader();
                        }
                        else
                        {

                            $.toaster({ priority: 'danger', title: '', message: data.Message });
                            RemoveLoader();
                        }
                    },
                    complete: function (data) {
                        RemoveLoader();
                    },
                    error: function (data) {
                        console.log(data)
                        RemoveLoader();
                    }

                });
            } 
            $(function () {
             FillData();
            $(document).ajaxSend(function (event, xhr, settings) {
                $(".jsLoading").attr("disabled", "disabled");
            });
            $(document).ajaxComplete(function (event, xhr, settings) {
                $(".jsLoading").removeAttr("disabled");
            });


            $(document).on("submit", "#frmAddSchool", function (e) {
                e.preventDefault();
                AddSchoolInDB(e);
            });

            $(document).on("click", ".jsView", function (e) {
                var dataid = $(this).attr("data-id");
                var datatitle = $(this).attr("data-title");
                var uc = $(this).attr("data-uc");
                View(datatitle, dataid, uc);
            });
            $(document).on("click", ".jsEdit", function (e) {
                var id = $(this).attr("data-id");
                var title = $(this).attr("data-title");
                var role = $(this).attr("data-role");
                Add("Update | " + title+"",id);
            });
            $(document).on("click", ".jsActiveInactive", function () {
                var id = $(this).attr("data-id");
                var title = $(this).attr("data-title");
                ActiveInactive(id);

            });

            $(document).on("click", ".jsImg", function (e) {
                var src = $(this).attr("src")
                var title = $(this).attr("data-title")
                var html = '<div class="row"><div class="col-lg-12"><img class="img-responsive" style="width:100%"  src="' + src + '" alt=""></div><div class="col-lg-12"><h4>' + title + '</h4> </div></div>';
                //bootbox.dialog({
                //    title: title,
                //    message: ' <style> .modal-dialog {  max-width: 80% !important; margin: 1.75rem auto;} .modal-footer{text-align:center !important;}</style>' + html,
                //    closeButton: true,
                //    buttons: {
                //        success: {
                //            label: "Close",
                //            className: "jsLoading   btn btn-default",
                //            callback: function () {
                //                bootbox.hideAll();
                //            }
                //        }
                //    }
                //});

            });
        });
        </script>
    }
}
else
{
    <div class="col-md-12 text-center text-danger">
        <h4>@Model.Message</h4>
    </div>
}
